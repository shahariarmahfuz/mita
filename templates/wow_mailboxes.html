{% extends "layout.html" %}

{% block content %}
<style>
  .page-header { margin-bottom: 24px; }
  .page-title { font-size: 24px; font-weight: 600; color: #111827; margin: 0; }

  .card {
    background: #ffffff;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    overflow: hidden;
    box-shadow: 0 1px 2px rgba(0,0,0,0.05);
  }

  .table-wrapper { width: 100%; overflow-x: auto; }
  .table { width: 100%; border-collapse: collapse; font-size: 14px; }

  .table th {
    text-align: left; padding: 12px 16px; border-bottom: 1px solid #e5e7eb;
    background: #f9fafb; color: #6b7280; font-weight: 600; font-size: 12px; text-transform: uppercase;
  }

  .table td { padding: 16px; border-bottom: 1px solid #f3f4f6; color: #1f2937; vertical-align: middle; }
  .table tr:last-child td { border-bottom: none; }

  .mailbox-link {
    font-weight: 600; color: #0969da; text-decoration: none; font-size: 15px;
    display: inline-flex; align-items: center; gap: 8px;
  }
  .mailbox-link:hover { text-decoration: underline; }

  .owner-text {
    margin-top: 6px;
    font-size: 12px;
    color: #6b7280;
  }

  .owner-badge {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    background: #fef3c7;
    color: #92400e;
    padding: 2px 6px;
    border-radius: 10px;
    font-size: 11px;
    font-weight: 600;
  }

  .count-badge {
    background: #eff6ff; color: #1d4ed8; padding: 4px 10px;
    border-radius: 20px; font-size: 12px; font-weight: 600;
  }

  .time-text { color: #6b7280; font-size: 13px; display: inline-flex; align-items: center; gap: 5px; }
  .icon-svg { width: 18px; height: 18px; stroke-width: 1.8; color: #9ca3af; }
  .icon-small { width: 14px; height: 14px; }

  @media screen and (max-width: 768px) {
    .table thead { display: none; }

    .table tbody { display: flex; flex-direction: column; gap: 12px; padding: 12px; background: #f9fafb; }

    .table tr {
      display: grid;
      grid-template-areas:
        "name name"
        "count time";
      grid-template-columns: 1fr 1fr;
      gap: 8px;

      background: #ffffff;
      border: 1px solid #e5e7eb;
      border-radius: 10px;
      padding: 16px;
      box-shadow: 0 1px 2px rgba(0,0,0,0.02);
    }

    .table td { border: none; padding: 0; }

    .table td:nth-child(1) { grid-area: name; margin-bottom: 6px; }
    .table td:nth-child(2) { grid-area: count; align-self: center; }
    .table td:nth-child(3) { grid-area: time; justify-self: end; align-self: center; }
  }
</style>

  <div class="page-header">
    <h1 class="page-title">All Mailboxes</h1>
  </div>

  {% if not mailboxes %}
    <div style="text-align:center; padding: 60px 20px; background:#fff; border-radius:12px; border:1px solid #e5e7eb; color: #6b7280;">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width:48px; height:48px; margin-bottom:12px; opacity:0.3;">
        <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5m8.25 3.25h3.25m-6.75 3.75h6.75M4.5 7.5h15m-15 0h15m-15 0H3m15 0h1.5m-15 0v-3.75a2.25 2.25 0 012.25-2.25h10.5a2.25 2.25 0 012.25 2.25V7.5" />
      </svg>
      <p style="font-size:16px;">No mailboxes found.</p>
    </div>
  {% else %}
    <div class="card">
      <div class="table-wrapper">
        <table class="table">
          <thead>
            <tr>
              <th>Mailbox Name</th>
              <th>Total Messages</th>
              <th>Last Activity</th>
            </tr>
          </thead>
          <tbody>
            {% for m in mailboxes %}
              <tr>
                <td>
                  <a class="mailbox-link" href="{{ url_for('wow_mailbox', mailbox_id=m.id) }}">
                    <svg class="icon-svg" style="color:#0969da;" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5m8.25 3.25h3.25m-6.75 3.75h6.75M4.5 7.5h15m-15 0h15m-15 0H3m15 0h1.5m-15 0v-3.75a2.25 2.25 0 012.25-2.25h10.5a2.25 2.25 0 012.25 2.25V7.5" />
                    </svg>
                    {{ m.address }}
                  </a>
                  <div class="owner-text">
                    Owner: {{ m.owner }}
                    {% if m.unassigned %}
                      <span class="owner-badge">Unassigned</span>
                    {% endif %}
                  </div>
                </td>

                <td>
                  <span class="count-badge">{{ m.count }} msgs</span>
                </td>

                <td>
                  <span class="time-text bd-time" data-time="{{ m.last_received_at }}">
                    <svg class="icon-svg icon-small" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                    </svg>
                    -
                  </span>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% endif %}

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const timeElements = document.querySelectorAll('.bd-time');
      timeElements.forEach(el => {
        const rawTime = el.getAttribute('data-time');

        if (rawTime && rawTime !== 'None') {
          const date = new Date(rawTime);
          if (!isNaN(date)) {
            const formatted = date.toLocaleString('en-BD', {
              timeZone: 'Asia/Dhaka',
              month: 'short', day: 'numeric',
              hour: 'numeric', minute: '2-digit', hour12: true
            });

            el.innerHTML = `
              <svg class="icon-svg icon-small" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg> ${formatted}`;
          } else {
            el.innerText = rawTime;
          }
        } else {
          el.innerText = "No activity";
        }
      });
    });
  </script>

{% endblock %}
