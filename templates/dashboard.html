{% extends "layout.html" %}

{% block content %}
<style>
  /* --- Dashboard Specific Styles --- */
  
  /* Page Title */
  .page-title {
    font-size: 24px;
    font-weight: 600;
    color: #111827;
    margin-bottom: 24px;
  }

  /* Cards */
  .card {
    background: #ffffff;
    border: 1px solid #e5e7eb;
    border-radius: 12px;
    padding: 24px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.05);
    margin-bottom: 24px;
  }

  /* Form Elements */
  .form-label {
    display: block;
    font-size: 14px;
    font-weight: 500;
    color: #374151;
    margin-bottom: 8px;
  }

  .input {
    width: 100%;
    padding: 10px 12px;
    border: 1px solid #d1d5db;
    border-radius: 6px;
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s;
    box-sizing: border-box; /* Fix width overflow */
  }

  .input:focus {
    border-color: #0969da;
    box-shadow: 0 0 0 3px rgba(9, 105, 218, 0.1);
  }

  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    padding: 10px 16px;
    border-radius: 6px;
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    border: none;
    transition: background-color 0.2s;
  }

  .btn-primary {
    background-color: #0969da; /* Github Blue */
    color: white;
  }
  .btn-primary:hover {
    background-color: #0a58ca;
  }

  .muted-text {
    font-size: 13px;
    color: #6b7280;
    margin-top: 12px;
    line-height: 1.5;
  }

  /* --- Responsive Table Design --- */
  .table-container {
    width: 100%;
    overflow-x: auto;
  }

  .table {
    width: 100%;
    border-collapse: collapse;
    font-size: 14px;
  }

  .table th {
    text-align: left;
    padding: 12px 16px;
    border-bottom: 1px solid #e5e7eb;
    color: #6b7280;
    font-weight: 600;
    font-size: 12px;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }

  .table td {
    padding: 16px;
    border-bottom: 1px solid #f3f4f6;
    color: #1f2937;
    vertical-align: middle;
  }

  .table tr:last-child td {
    border-bottom: none;
  }

  .mono {
    font-family: ui-monospace, SFMono-Regular, "SF Mono", Menlo, Consolas, "Liberation Mono", monospace;
    font-size: 13px;
    color: #0969da;
  }

  /* Status Badges with Icons */
  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 4px 10px;
    border-radius: 20px;
    font-size: 12px;
    font-weight: 500;
  }
  
  .status-enabled {
    background-color: #dafbe1;
    color: #1a7f37;
  }
  
  .status-warning {
    background-color: #fff8c5;
    color: #9a6700;
  }

  /* SVG Icons styling */
  .icon-svg {
    width: 16px;
    height: 16px;
  }

  /* --- Mobile Optimization (The Magic) --- */
  @media screen and (max-width: 768px) {
    /* Hide table headers on mobile */
    .table thead {
      display: none;
    }

    /* Turn rows into cards */
    .table tr {
      display: block;
      margin-bottom: 16px;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 12px;
      background: #f9fafb;
    }

    /* Turn cells into flex rows */
    .table td {
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid #e5e7eb;
      padding: 10px 0;
      text-align: right;
    }

    .table td:last-child {
      border-bottom: none;
    }

    /* Add labels using data-label attribute */
    .table td::before {
      content: attr(data-label);
      font-weight: 600;
      color: #6b7280;
      text-transform: uppercase;
      font-size: 11px;
      margin-right: 15px;
      text-align: left;
    }
    
    /* Adjust input and button for mobile */
    .btn { width: 100%; margin-top: 10px; }
  }
</style>

  <h1 class="page-title">Dashboard</h1>

  <div class="card">
    <h2 style="margin:0 0 16px 0; font-size:18px; font-weight:600;">Create new email</h2>
    <form method="post" action="{{ url_for('create_account') }}">
      <label class="form-label">Gmail address (user will link authenticator)</label>
      <input class="input" name="gmail" type="email" placeholder="example@gmail.com" required />
      
      <button class="btn btn-primary" type="submit">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor" style="width:18px; height:18px;">
          <path d="M11 11V5H13V11H19V13H13V19H11V13H5V11H11Z"></path>
        </svg>
        Create
      </button>
    </form>
    <p class="muted-text">
      After creation, open the account page to copy: Gmail, generated email, password, and authenticator code.
    </p>
  </div>

  {% if not accounts %}
    <div style="text-align:center; padding: 40px; color:#6b7280; background:#fff; border-radius:12px; border:1px solid #e5e7eb;">
      <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" style="width:40px; height:40px; margin-bottom:10px; opacity:0.5;">
        <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 01-2.25 2.25h-15a2.25 2.25 0 01-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0019.5 4.5h-15a2.25 2.25 0 00-2.25 2.25m19.5 0v.243a2.25 2.25 0 01-1.07 1.916l-7.5 4.615a2.25 2.25 0 01-2.36 0L3.32 8.91a2.25 2.25 0 01-1.07-1.916V6.75" />
      </svg>
      <p>No emails yet. Create one above.</p>
    </div>
  {% else %}
    <div class="card" style="padding: 0; overflow: hidden;">
      <div class="table-container">
        <table class="table">
          <thead>
            <tr>
              <th>Gmail</th>
              <th>Generated Email</th>
              <th>Authenticator</th>
              <th>Messages</th>
              <th>Last received</th>
            </tr>
          </thead>
          <tbody>
            {% for a in accounts %}
              <tr>
                <td data-label="Gmail">
                  <span class="mono" style="color:#374151;">{{ a.gmail }}</span>
                </td>
                
                <td data-label="Generated Email">
                  <a href="{{ url_for('account_view', account_id=a.id) }}" class="mono" style="text-decoration:none;">
                    {{ a.email }}
                  </a>
                </td>
                
                <td data-label="Status">
                  {% if a.has_totp %}
                    <span class="status-badge status-enabled">
                      <svg class="icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path fill-rule="evenodd" d="M2.25 12c0-5.385 4.365-9.75 9.75-9.75s9.75 4.365 9.75 9.75-4.365 9.75-9.75 9.75S2.25 17.385 2.25 12zm13.36-1.814a.75.75 0 10-1.22-.872l-3.236 4.53L9.53 12.22a.75.75 0 00-1.06 1.06l2.25 2.25a.75.75 0 001.14-.094l3.75-5.25z" clip-rule="evenodd" />
                      </svg>
                      Enabled
                    </span>
                  {% else %}
                    <span class="status-badge status-warning">
                      <svg class="icon-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z" clip-rule="evenodd" />
                      </svg>
                      Not Set
                    </span>
                  {% endif %}
                </td>
                
                <td data-label="Messages">
                  <span style="font-weight:600; color:#374151;">{{ a.msg_count }}</span>
                </td>
                
                <td data-label="Last Received">
                  <code style="background:#f3f4f6; padding:4px 6px; border-radius:4px; font-size:12px;">{{ a.last_received or "-" }}</code>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% endif %}

{% endblock %}
